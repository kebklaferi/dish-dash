{"openapi":"3.0.3","info":{"title":"Orders Service API","version":"1.0.0","description":"Orders microservice for food delivery platform","contact":{"name":"API Support","email":"support@fooddelivery.com"}},"servers":[{"url":"http://localhost:8088/api/orders","description":"API Gateway"},{"url":"http://localhost:3001","description":"Direct Access"}],"tags":[{"name":"Orders","description":"Order management operations"}],"security":[{"bearerAuth":[]}],"components":{"securitySchemes":{"bearerAuth":{"type":"http","scheme":"bearer","bearerFormat":"JWT","description":"Enter JWT token obtained from /api/auth/login"}},"schemas":{"Order":{"type":"object","properties":{"id":{"type":"string","format":"uuid","example":"123e4567-e89b-12d3-a456-426614174000"},"customerId":{"type":"string","example":"customer_123"},"restaurantId":{"type":"string","example":"rest_001"},"deliveryAddress":{"type":"string","example":"123 Main St, Apt 4B, New York, NY 10001"},"items":{"type":"array","items":{"$ref":"#/components/schemas/OrderItem"}},"totalAmount":{"type":"number","format":"float","example":45.99},"status":{"type":"string","enum":["pending","confirmed","preparing","out_for_delivery","delivered","cancelled"],"example":"pending"},"deliveryFee":{"type":"number","format":"float","example":5.99},"paymentMethod":{"type":"string","enum":["CREDIT_CARD","CASH_ON_DELIVERY"],"example":"CREDIT_CARD","description":"Payment method used for this order"},"notes":{"type":"string","example":"Please ring the doorbell"},"createdAt":{"type":"string","format":"date-time"},"updatedAt":{"type":"string","format":"date-time"}}},"OrderItem":{"type":"object","properties":{"id":{"type":"string","format":"uuid"},"orderId":{"type":"string","format":"uuid"},"menuItemId":{"type":"string","example":"menu_001"},"name":{"type":"string","example":"Margherita Pizza"},"quantity":{"type":"integer","minimum":1,"example":2},"price":{"type":"number","format":"float","example":12.99},"specialInstructions":{"type":"string","example":"Extra cheese, no olives"}}},"Payment":{"type":"object","required":["method"],"properties":{"method":{"type":"string","enum":["CREDIT_CARD","CASH_ON_DELIVERY"],"example":"CREDIT_CARD","description":"Payment method - CREDIT_CARD triggers payment processing via RabbitMQ"},"cardNumber":{"type":"string","example":"4242424242424242","description":"Required for CREDIT_CARD payments - 16 digits"},"expiryMonth":{"type":"string","example":"12","description":"Required for CREDIT_CARD payments - MM format"},"expiryYear":{"type":"string","example":"25","description":"Required for CREDIT_CARD payments - YY format"},"cvv":{"type":"string","example":"123","description":"Required for CREDIT_CARD payments - 3 or 4 digits"},"cardholderName":{"type":"string","example":"John Doe","description":"Required for CREDIT_CARD payments"}}},"CreateOrderRequest":{"type":"object","required":["restaurantId","deliveryAddress","items","payment"],"properties":{"restaurantId":{"type":"string","example":"1","description":"ID of the restaurant"},"deliveryAddress":{"type":"string","example":"123 Main St, Apt 4B","description":"Full delivery address"},"items":{"type":"array","items":{"type":"object","required":["menuItemId","quantity"],"properties":{"menuItemId":{"type":"string","example":"1"},"quantity":{"type":"integer","minimum":1,"example":2},"specialInstructions":{"type":"string","example":"Extra cheese, no onions"}}},"minItems":1},"deliveryFee":{"type":"number","format":"float","example":5.99,"description":"Delivery fee amount"},"notes":{"type":"string","example":"Please ring the doorbell","description":"Additional order notes"},"payment":{"$ref":"#/components/schemas/Payment","description":"Payment details (required). If method is CASH_ON_DELIVERY, only method field is needed. If method is CREDIT_CARD, card details are required and order is sent to PaymentService via RabbitMQ."}}}}},"paths":{"/logs/save":{"post":{"summary":"Save all logs from RabbitMQ to database","tags":["Logs"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"Logs saved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"saved":{"type":"number"},"errors":{"type":"number"}}}}}}}}},"/logs":{"get":{"summary":"Get logs between dates","tags":["Logs"],"security":[{"bearerAuth":[]}],"parameters":[{"in":"query","name":"startDate","required":true,"schema":{"type":"string","format":"date-time"},"description":"Start date (ISO 8601 format)"},{"in":"query","name":"endDate","required":true,"schema":{"type":"string","format":"date-time"},"description":"End date (ISO 8601 format)"},{"in":"query","name":"level","schema":{"type":"string","enum":["Info","Error","Warn"]},"description":"Filter by log level"},{"in":"query","name":"correlationId","schema":{"type":"string"},"description":"Filter by correlation ID"}],"responses":{"200":{"description":"Logs retrieved successfully","content":{"application/json":{"schema":{"type":"object","properties":{"count":{"type":"number"},"logs":{"type":"array","items":{"type":"object"}}}}}}}}},"delete":{"summary":"Delete all logs from database","tags":["Logs"],"security":[{"bearerAuth":[]}],"responses":{"200":{"description":"All logs deleted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string"},"deletedCount":{"type":"number"}}}}}}}}},"/orders":{"get":{"tags":["Orders"],"summary":"Get orders","description":"Get all orders for authenticated user. Admins can see all orders.","parameters":[{"in":"query","name":"status","schema":{"type":"string","enum":["pending","confirmed","preparing","out_for_delivery","delivered","cancelled"]},"description":"Filter orders by status"}],"responses":{"200":{"description":"List of orders retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Order"}}}}},"500":{"description":"Internal server error"}}},"post":{"tags":["Orders"],"summary":"Create a new order","description":"Create a new food delivery order. Menu item details (name, price) are automatically fetched from CatalogService.\n\n**Payment Processing (Required):**\n- If `payment.method` is `CREDIT_CARD`: Order is sent to PaymentService via RabbitMQ for processing. Order status will be updated based on payment result.\n- If `payment.method` is `CASH_ON_DELIVERY`: Order is confirmed immediately without payment processing.\n\n**Note:** Payment information is mandatory. You must specify either CREDIT_CARD or CASH_ON_DELIVERY.\n","requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/CreateOrderRequest"},"examples":{"creditCard":{"summary":"Order with credit card payment","value":{"restaurantId":"1","deliveryAddress":"123 Main St, Apt 4B","items":[{"menuItemId":"1","quantity":2,"specialInstructions":"Extra cheese, no onions"}],"deliveryFee":5.99,"notes":"Please ring the doorbell","payment":{"method":"CREDIT_CARD","cardNumber":"4242424242424242","expiryMonth":"12","expiryYear":"25","cvv":"123","cardholderName":"John Doe"}}},"cashOnDelivery":{"summary":"Order with cash on delivery","value":{"restaurantId":"1","deliveryAddress":"123 Main St, Apt 4B","items":[{"menuItemId":"1","quantity":2,"specialInstructions":"No onions please"}],"deliveryFee":5.99,"notes":"Call when you arrive","payment":{"method":"CASH_ON_DELIVERY"}}}}}}},"responses":{"201":{"description":"Order created successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Order"}}}},"400":{"description":"Invalid request - missing required fields, invalid menu items, or missing/invalid payment information"},"500":{"description":"Internal server error"}}}},"/orders/{id}":{"get":{"tags":["Orders"],"summary":"Get order by ID","description":"Retrieve a specific order by its unique ID","parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"Order ID (UUID)"}],"responses":{"200":{"description":"Order retrieved successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Order"}}}},"400":{"description":"Invalid order ID"},"404":{"description":"Order not found"},"500":{"description":"Internal server error"}}},"put":{"tags":["Orders"],"summary":"Update order","description":"Update an existing order's details, items, or status (Admin only)","parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"Order ID (UUID)"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","properties":{"deliveryAddress":{"type":"string","example":"456 Oak Ave"},"items":{"type":"array","items":{"type":"object","required":["menuItemId","quantity"],"properties":{"menuItemId":{"type":"integer","example":2},"quantity":{"type":"integer","minimum":1,"example":1},"specialInstructions":{"type":"string","example":"Well done"}}}},"notes":{"type":"string","example":"Updated delivery instructions"},"status":{"type":"string","enum":["pending","confirmed","preparing","out_for_delivery","delivered","cancelled"]}}}}}},"responses":{"200":{"description":"Order updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Order"}}}},"400":{"description":"Invalid request body or order ID"},"403":{"description":"Access denied"},"404":{"description":"Order not found"},"500":{"description":"Internal server error"}}},"delete":{"tags":["Orders"],"summary":"Delete order","description":"Permanently delete an order and all its items (Admin only)","parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"Order ID (UUID)"}],"responses":{"204":{"description":"Order deleted successfully (no content)"},"400":{"description":"Invalid order ID"},"403":{"description":"Access denied"},"404":{"description":"Order not found"},"500":{"description":"Internal server error"}}}},"/orders/me/recent":{"get":{"tags":["Orders"],"summary":"Get my recent orders","description":"Retrieve the most recent orders for the authenticated user","parameters":[{"in":"query","name":"limit","schema":{"type":"integer","default":10,"minimum":1,"maximum":100},"description":"Maximum number of orders to return"}],"responses":{"200":{"description":"List of recent orders retrieved successfully","content":{"application/json":{"schema":{"type":"array","items":{"$ref":"#/components/schemas/Order"}}}}},"500":{"description":"Internal server error"}}}},"/orders/{id}/cancel":{"post":{"tags":["Orders"],"summary":"Cancel an order","description":"Cancel an order by changing its status to cancelled. Cannot cancel delivered or already cancelled orders.","parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"Order ID (UUID)"}],"responses":{"200":{"description":"Order cancelled successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Order"}}}},"400":{"description":"Cannot cancel order (already delivered/cancelled)"},"403":{"description":"Access denied"},"404":{"description":"Order not found"},"500":{"description":"Internal server error"}}}},"/orders/{id}/status":{"put":{"tags":["Orders"],"summary":"Update order status","description":"Update only the status of an order (Admin only)","parameters":[{"in":"path","name":"id","required":true,"schema":{"type":"string","format":"uuid"},"description":"Order ID (UUID)"}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"type":"object","required":["status"],"properties":{"status":{"type":"string","enum":["pending","confirmed","preparing","out_for_delivery","delivered","cancelled"],"example":"preparing"}}}}}},"responses":{"200":{"description":"Order status updated successfully","content":{"application/json":{"schema":{"$ref":"#/components/schemas/Order"}}}},"400":{"description":"Invalid request - missing status field"},"403":{"description":"Access denied"},"404":{"description":"Order not found"},"500":{"description":"Internal server error"}}}},"/orders/me":{"delete":{"tags":["Orders"],"summary":"Delete all my orders","description":"Permanently delete all orders for the authenticated user","responses":{"200":{"description":"All user orders deleted successfully","content":{"application/json":{"schema":{"type":"object","properties":{"message":{"type":"string","example":"Successfully deleted 5 order(s)"},"deletedCount":{"type":"integer","example":5}}}}}},"500":{"description":"Internal server error"}}}}}}